L'étape de post-exploitation est bien souvent abordée de manière bien trop sommaire. Certains modèles conceptuels tels que la cyber kill-chain de lockheed martin passe cette étape en revue aux travers de quelques étapes clés d'un processus bien plus vaste.

Pourtant si les vecteurs d'infection et d'exploitation sont cruciaux, la post-exploitation représente près de 80% d'une attaque informatique. Cette partie va montrer différentes étapes à prendre en compte pour passer d'une exploitation initiale vers une élévation de privilèges et prendre entièrement le contrôle de la machine.

A ce stade, vous avez pu avoir un premier accès, mais celui-ci est peut-être restreint, que ce soit du fait que vous ne connaissez pas encore le mot de passe de l'utilisateur compromis (et donc que vous ne pouvez pas initier un vrai shell via SSH) et/ou que l'utilisateur en question ne dispose que de droits très limités sur la machine.

## Le but de l'énumération avec accès initial
Il va dépendre de votre état final recherché (vol d'information / sabotage / avec ou sans persistance sur la machine ou le réseau...). Généralement l'intérêt est de comprendre :
* quel type de poste s'agit-il ? (Un client / un serveur)
* quelle est la sensibilité des informations contenues sur cette machine ? 
* quels sont les accès au réseau interne et y a-t-il possibilité d'accéder à des ressources distantes ? 
* quels sont les droits de l'utilisateur (sur la machine ? sur le réseau ?) 

## Les étapes d'une énumération avec accès initial 
La première étape consiste à réeffectuer une reconnaissance depuis le shell dont vous disposez, aussi restreint qu'il soit. Pour cela il faudra utiliser les principales commandes systèmes disponible (id, whoami, cd, ls, cat, find, grep...) de manière à prendre le plus de renseignements sur :

* le système d'exploitation, la version de son noyau
* vos droits sur cette machine (et d'éventuels identifiants présents sur des fichiers accessible en lecture)
* les processus tournant sur le serveur (et donc les services présents et éventuellement leurs versions)
* la liste des utilisateurs (peut-être que certains ont des mots de passe faibles ou lisibles à certains endroits)
* les tâches planifiées (cron / crontab)

## Shell et TTY
"tty" est une commande Unix qui affiche sur la sortie standard le nom du fichier connecté sur l'entrée standard. L'origine du nom tty vient de l'anglais teletypewriter, qui se traduit téléscripteur, et a été abrégé en « TTY ». Cela parait assez obscure dit comme ça mais c'est un point essentiel dans l'accès aux commandes en console. Si vous ne disposez pas d'un accès SSH mais d'un reverse shell envoyé au travers d'une vulnérabilité vous aurez probablement un accès console très restreint. Il vous sera entre autre impossible d'utiliser des commandes qui attendent une entrée de votre part au cours de leur execution (su / sudo ...), et on ne parle même pas des applicatifs consoles enrichis tels que nano / vim ... Les flux d'entrées/sorties ne sont pas accessibles comme vous le voudriez. Une des étapes de l'accès initial va être d'obtenir un "full-tty" (au travers de netcat / python / socat...). Il existe de très nombreuses possibilités et de nombreux tutoriels sont accessibles sur internet pour illustrer comment y arriver.

## Living of the land
Avant de déposer trop d'outils sur le poste (et risquer une détection), il est nécessaire de lister tous les applicatifs présents pour lesquels votre utilisateur à des droits d'exécution. Le principal enjeu est de pouvoir énumérer un maximum et enrichir votre connaissance sur cette machine et si possible avec le moins d'outils supplémentaires possibles. 

## quels outils ensuite ?
Si vous souhaitez aller plus loin et/ou plus vite, vous disposez d'un panel gigantesque de solutions. Les outils a utiliser tout comme la fréquence entre les commandes qui va être envoyée dépend du niveau de détection du réseau ciblé et de l'empreinte que vous désirez laisser sur le poste cible. Dans le cadre de cet entrainement, le but n'étant pas forcément la discrétion, voici quelques outils que j'ai tendance a toujours mettre en place sur le poste lors de la plupart des CTF:

Sur le poste victime :
https://github.com/rebootuser/LinEnum => un script d'énumération complet pour les systèmes sous Linux
https://github.com/flozz/p0wny-shell => un webshell single file, simple et efficace et malgré tout peu connu (donc assez peu détecté)
https://www.adminer.org/ => équivalent de phpmyadmin en un fichier (intéressant à déposer sur le serveur web si pas de phpmyadmin)

Sur la machine d’attaque :
John the ripper / hydra => outils d'attaques de mots de passe (utiles pour des comptes avec un mot de passe faible)

-----
En faisant quelques recherches vous trouverez probablement des scripts plus complets. Parmi ceux-ci, un projet récent semble plutôt prometteur mais ce n'est qu'une suggestion parmi de très nombreuses possibilités : https://github.com/TheSecondSun/Bashark 

## En route vers la recherche de vulnérabilités 
Une fois ce système maitrisé au maximum, il ne vous reste plus qu'à énumérer les vulnérabilités de tous les services et voir quel est le vecteur d'exploitation le plus simple à mettre en place. Plusieurs pistes à ce sujet seront abordées dans la partie suivante.


